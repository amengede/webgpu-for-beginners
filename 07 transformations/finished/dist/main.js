(()=>{"use strict";const t="struct TransformData {\r\n    model: mat4x4<f32>,\r\n    view: mat4x4<f32>,\r\n    projection: mat4x4<f32>,\r\n};\r\n@binding(0) @group(0) var<uniform> transformUBO: TransformData;\r\n\r\nstruct Fragment {\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) Color : vec4<f32>\r\n};\r\n\r\n@vertex\r\nfn vs_main(@location(0) vertexPostion: vec3<f32>, @location(1) vertexColor: vec3<f32>) -> Fragment {\r\n\r\n    var output : Fragment;\r\n    output.Position = transformUBO.projection * transformUBO.view * transformUBO.model * vec4<f32>(vertexPostion, 1.0);\r\n    output.Color = vec4<f32>(vertexColor, 1.0);\r\n\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fs_main(@location(0) Color: vec4<f32>) -> @location(0) vec4<f32> {\r\n    return Color;\r\n}";class e{constructor(t){const e=new Float32Array([0,0,.5,1,0,0,0,-.5,-.5,0,1,0,0,.5,-.5,0,0,1]),r=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,i={size:e.byteLength,usage:r,mappedAtCreation:!0};this.buffer=t.createBuffer(i),new Float32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap(),this.bufferLayout={arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]}}}var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var t=new i(16);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var o=function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))};const a=document.getElementById("gfx-main"),s=new class{constructor(t){this.t=0,this.render=()=>{this.t+=.01,this.t>2*Math.PI&&(this.t-=2*Math.PI);const t=n();!function(t,e,r,i,n){var o,a=1/Math.tan(e/2);t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i)}(t,Math.PI/4,800/600,.1,10);const e=n();var i,o,a,s,u,f,c,h,d,l,v,m,p,g,y,b,M,P,B,x,w,U,A;i=e,y=(o=[-2,0,2])[0],b=o[1],M=o[2],P=(s=[0,0,1])[0],B=s[1],x=s[2],w=(a=[0,0,0])[0],U=a[1],A=a[2],Math.abs(y-w)<r&&Math.abs(b-U)<r&&Math.abs(M-A)<r?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(i):(v=y-w,m=b-U,p=M-A,u=B*(p*=g=1/Math.hypot(v,m,p))-x*(m*=g),f=x*(v*=g)-P*p,c=P*m-B*v,(g=Math.hypot(u,f,c))?(u*=g=1/g,f*=g,c*=g):(u=0,f=0,c=0),h=m*c-p*f,d=p*u-v*c,l=v*f-m*u,(g=Math.hypot(h,d,l))?(h*=g=1/g,d*=g,l*=g):(h=0,d=0,l=0),i[0]=u,i[1]=h,i[2]=v,i[3]=0,i[4]=f,i[5]=d,i[6]=m,i[7]=0,i[8]=c,i[9]=l,i[10]=p,i[11]=0,i[12]=-(u*y+f*b+c*M),i[13]=-(h*y+d*b+l*M),i[14]=-(v*y+m*b+p*M),i[15]=1);const C=n();!function(t,e,i,n){var o,a,s,u,f,c,h,d,l,v,m,p,g,y,b,M,P,B,x,w,U,A,C,G,F=n[0],q=n[1],O=n[2],I=Math.hypot(F,q,O);I<r||(F*=I=1/I,q*=I,O*=I,o=Math.sin(i),s=1-(a=Math.cos(i)),u=e[0],f=e[1],c=e[2],h=e[3],d=e[4],l=e[5],v=e[6],m=e[7],p=e[8],g=e[9],y=e[10],b=e[11],M=F*F*s+a,P=q*F*s+O*o,B=O*F*s-q*o,x=F*q*s-O*o,w=q*q*s+a,U=O*q*s+F*o,A=F*O*s+q*o,C=q*O*s-F*o,G=O*O*s+a,t[0]=u*M+d*P+p*B,t[1]=f*M+l*P+g*B,t[2]=c*M+v*P+y*B,t[3]=h*M+m*P+b*B,t[4]=u*x+d*w+p*U,t[5]=f*x+l*w+g*U,t[6]=c*x+v*w+y*U,t[7]=h*x+m*w+b*U,t[8]=u*A+d*C+p*G,t[9]=f*A+l*C+g*G,t[10]=c*A+v*C+y*G,t[11]=h*A+m*C+b*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(C,C,this.t,[0,0,1]),this.device.queue.writeBuffer(this.uniformBuffer,0,C),this.device.queue.writeBuffer(this.uniformBuffer,64,e),this.device.queue.writeBuffer(this.uniformBuffer,128,t);const G=this.device.createCommandEncoder(),F=this.context.getCurrentTexture().createView(),q=G.beginRenderPass({colorAttachments:[{view:F,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}]});q.setPipeline(this.pipeline),q.setVertexBuffer(0,this.triangleMesh.buffer),q.setBindGroup(0,this.bindGroup),q.draw(3,1,0,0),q.end(),this.device.queue.submit([G.finish()]),requestAnimationFrame(this.render)},this.canvas=t,this.t=0}Initialize(){return o(this,void 0,void 0,(function*(){yield this.setupDevice(),this.createAssets(),yield this.makePipeline(),this.render()}))}setupDevice(){var t,e;return o(this,void 0,void 0,(function*(){this.adapter=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),this.device=yield null===(e=this.adapter)||void 0===e?void 0:e.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}makePipeline(){return o(this,void 0,void 0,(function*(){this.uniformBuffer=this.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const e=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]});this.bindGroup=this.device.createBindGroup({layout:e,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const r=this.device.createPipelineLayout({bindGroupLayouts:[e]});this.pipeline=this.device.createRenderPipeline({vertex:{module:this.device.createShaderModule({code:t}),entryPoint:"vs_main",buffers:[this.triangleMesh.bufferLayout]},fragment:{module:this.device.createShaderModule({code:t}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},layout:r})}))}createAssets(){this.triangleMesh=new e(this.device)}}(a);s.Initialize()})();